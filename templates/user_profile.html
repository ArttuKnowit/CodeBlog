{% extends 'base.html' %}
{% block title %}User Profile{% endblock %}
{% block content %}
<h2>User Profile: {{ (profile_user.username if profile_user else user.username) }}</h2>

{% if profile_user %}
  <div class="card mb-3">
    <div class="card-body">
      <h5 class="card-title">Introduction</h5>
      {% if user and profile_user.id == user.id %}
        <form method="post" action="{{ url_for('update_intro') }}">
          <div class="form-group">
            <textarea name="intro" class="form-control" rows="4" placeholder="Write something about yourself...">{{ profile_user.intro or '' }}</textarea>
          </div>
          <button type="submit" class="btn btn-primary">Save Intro</button>
        </form>
      {% else %}
        <p style="white-space: pre-wrap;">{{ profile_user.intro or 'No introduction yet.' }}</p>
      {% endif %}
    </div>
  </div>
{% endif %}

<h3>{% if profile_user and user and profile_user.id == user.id %}Your favorite{% else %}Favorite{% endif %} posts</h3>
<ul>
  {% for post in favorites %}
    <li><a href="{{ url_for('post', post_id=post['id']) }}">{{ post['title'] }}</a></li>
  {% else %}
    <li>No favorites yet.</li>
  {% endfor %}
</ul>

<h3>{% if profile_user and user and profile_user.id == user.id %}Your{% else %}User's{% endif %} posts</h3>
<ul>
  {% for post in user_posts %}
    <li><a href="{{ url_for('post', post_id=post['id']) }}">{{ post['title'] }}</a></li>
  {% else %}
    <li>No posts yet.</li>
  {% endfor %}
</ul>

<h3>{% if profile_user and user and profile_user.id == user.id %}Your{% else %}User's{% endif %} comments</h3>
<ul>
  {% for comment in user_comments %}
    <li>On <a href="{{ url_for('post', post_id=comment['post_id']) }}">{{ comment['post_title'] }}</a>: {{ comment['content'] }}</li>
  {% else %}
    <li>No comments yet.</li>
  {% endfor %}
</ul>
{% endblock %}
